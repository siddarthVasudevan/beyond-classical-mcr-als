# Beyond Classical MCR-ALS

This repository contains datasets and the code used for analyzing and plotting the results
from the datasets referenced in the following paper


## Repository Structure

The repository contains datasets, results from analysis of the datasets, and codes
for both analysis and visualization of the datasets.

### Datasets Directory

The **datasets** directiory contains two subdirectories **raman** and **rxn** which contains
the respective datasets.

1. **raman** directory: contains 3 csv files, `raman.csv`, `raman_raw.csv`, and `known_H_raman.csv`.
   The `raman.csv` contains the corrected raman data, the `raman_raw.csv` contains the raw Raman
   data, and the `known_H_raman.csv` contains the known concentration values at the values. The
   nan entries in `known_H_raman.csv` correspond to unknown concentration timepoints.

2. **rxn** subdirectory: contains several csv files. All csv files with the name format    `X_100dPt_<>csv` contain the spectral data corresponding to either Rxn1 or Rxn2 dataset with a specific noise level. The csv files with the name format `H_100dPt_<>.csv` contains the groundtruth of the rnx1 and rxn2 datsets. `pure_spectra.csv` file contains the ground truth of the pure spectra without noise used for generating the spectral data of rxn1 and rxn2 datasets.

### Scripts

See the module level docstrings for each .py file does. A short summary is provided below:

- `gen_rxn_dset.py`: Generates the Rxn1 and Rxn2 datasets and saves it to the path *./datasets/rnx/*

- `rxn_dset_analysis.py`: Analysis for Rxn datasets with varying noise levels for different
  combinations of known concentrations. The results generated are saved to the path *./rxn-comb-results/*. **Note**: this script can take from several minutes to few hours to run
  depending on the number of cores present in the computer where it is running from.

- `gen_rxn_dset_plots.py`: generates all the visualizations shown in the main article and SI
  of the paper for the Rxn dataset

- `analyze_and_gen_raman_dset_plots.py`: Analyzes and generates visualizations shown in the main
  article of the paper for the Raman dataset.

- `example_rxn2_plots_in_SI.py`: Creates visualizations of NMF results for Rxn2 dataset, shown
  in the SI of the paper.

- `figure_templates.py`: Utility module for creating the templates for the figures shown in the
  main article and SI of the paper.

### raman-figures directory

Contains the figures generated by analyzing and visualizing the Raman dataset. These figures
are generated by running the script `analyze_and_gen_raman_dset_plots.py`

### rxn-comb-results directory

Contains the results generated by analyzing the Rxn dataset. These results are generated by
running the script `rxn_dset_analysis.py`

### rxn-figures directory

Contains the figures generated by visualizing the results in the directory *rxm-comb-results*.
These figures are generated by running the script `gen_rxn_dset_plots.py`.

## Usage

To run the scripts in this repository, you'll need to set up a conda environment with the required dependencies. The packages listed below can be downloaded from conda-forge:

* mcrnmf
* Numpy
* Pandas
* Matplotlib
* SciPy
* Scikit-learn
* Joblib

For convenience, an `environment.yml` file is included in the repository. You can use this
file to create the environment with the correct dependencies by following these steps:

1. **Install Conda**: If you haven't already, install conda for instance through miniforge

2. **Create the environment**: Navigate to the directory containing the `environment.yml` file
   and run the following command in your terminal or miniforge prompt (if on Windows):
   ```bash
    conda env create -f environment.yml -n <your-environment-name>
    ```
    Replace `<your-environment-name>` with a name of your choice for the new environment

3. **Run the script**: An example:
    ```bash
    python gen_rxn_dset.py
    ````